<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>年末ジャンボ 当せんチェッカー</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="ambient-bg"></div>
  <canvas id="fireworks" class="fireworks" aria-hidden="true"></canvas>

  <div class="header-block">
    <p class="eyebrow" data-i18n="eyebrow">Nenmatsu Jumbo Checker</p>
    <header class="title-row">
      <h1 class="app-title" data-i18n="title">年末ジャンボ 当せんチェッカー</h1>
      <div class="control-panel">
        <div class="lang-switch">
          <div class="select-wrapper lang-select-wrapper">
            <select id="lang" class="lang-select" aria-label="Language">
              <option value="zh">中文</option>
              <option value="ja">日本語</option>
              <option value="en">English</option>
            </select>
            <svg class="select-icon" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <button id="langBtn" class="lang-btn" type="button" aria-label="Language">
            <span class="lang-indicator">日</span>
          </button>
            <div id="langMenu" class="lang-menu" role="menu">
              <button type="button" class="lang-item" data-lang="zh">中文</button>
              <button type="button" class="lang-item" data-lang="ja">日本語</button>
              <button type="button" class="lang-item" data-lang="en">English</button>
            </div>
        </div>
        <button id="theme" class="theme-btn" type="button" aria-label="Toggle Theme">
          <span class="theme-icon">☀</span>
        </button>
      </div>
    </header>
  </div>

  <main class="page">
    <section class="card-shell">


      <div class="type-round-row">
        <div class="form-group">
          <label class="input-label" data-i18n="type_label">種類</label>
          <div class="type-switch" role="group" aria-label="Ticket Type">
            <button class="type-btn is-active" type="button" data-type="jumbo" aria-pressed="true" data-i18n="type_jumbo">年末ジャンボ</button>
            <button class="type-btn" type="button" data-type="mini" aria-pressed="false" data-i18n="type_mini">年末ジャンボミニ</button>
          </div>
        </div>

        <div class="form-group">
          <div class="round-row">
            <div class="select-wrapper full-width">
              <select id="round">
                <option value="2024_jumbo_1031" data-type="jumbo" data-year="2024" data-round="1031" data-i18n="opt_2024_jumbo">2024 年末ジャンボ（第1031回）</option>
                <option value="2024_mini_1032" data-type="mini" data-year="2024" data-round="1032" data-i18n="opt_2024_mini">2024 年末ジャンボミニ（第1032回）</option>
              </select>
              <svg class="select-icon" width="14" height="14" viewBox="0 0 12 12" fill="none"><path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <button id="latest" class="button" type="button" data-i18n="latest_btn">最新へ</button>
            <button id="showPrizes" class="button" type="button" data-i18n="show_prizes">当选号</button>
          </div>
        </div>
      </div>

      <div class="form-group">
        <div class="label-row">
          <label class="input-label" data-i18n="buy_label">購入タイプ</label>
          <p class="helper-text" data-i18n="buy_hint" data-buy-hint>連番は組＋番号の先頭5桁を入力すると、10連番を自動追加します。</p>
        </div>
        <div class="tab-switch" role="group" aria-label="Purchase Type">
          <button class="tab-btn is-active" type="button" data-buy="bara" aria-pressed="true" data-i18n="buy_bara">バラ</button>
          <button class="tab-btn" type="button" data-buy="renban" aria-pressed="false" data-i18n="buy_renban">連番</button>
        </div>
      </div>

      <div class="input-row">
        <div class="form-group">
          <label for="group" class="input-label" data-i18n="group_label">組</label>
          <input id="group" type="text" inputmode="numeric" pattern="\\d{1,3}" maxlength="3" class="modern-input" placeholder="110" data-i18n-placeholder="group_ph" />
        </div>

        <div class="form-group">
          <label for="number" class="input-label" data-i18n="number_label">番号</label>
          <input id="number" type="text" inputmode="numeric" pattern="\\d{6}" maxlength="6" class="modern-input" placeholder="123456" data-i18n-placeholder="number_ph" />
        </div>

        <div class="form-group">
          <label class="input-label" data-i18n="add_label">追加</label>
          <button id="add" class="button full-width" type="button" data-i18n="add_btn">追加する</button>
        </div>

        <div class="form-group scan-group">
          <label class="input-label" data-i18n="scan_label">拍照识别</label>
          <button id="scan" class="button full-width scan-button" type="button" data-i18n="scan_btn_note">拍照识别（测试中不稳定）</button>
        </div>
      </div>

      <div class="action-area">
        <button id="scanMobile" class="button scan-mobile" type="button" data-i18n="scan_btn_note">拍照识别（测试中不稳定）</button>
        <p class="hint-text" data-i18n="hint">入力内容は保存されません。</p>
      </div>

      <div class="result-area">
        <div class="export-row">
          <label class="input-label" data-i18n="export_label">导入/导出</label>
          <div class="export-controls">
            <button id="exportGenerate" class="button" type="button" data-i18n="export_generate">生成</button>
            <input id="exportText" class="modern-input export-input" type="text" data-i18n-placeholder="export_ph" placeholder="短文本..." readonly />
            <button id="exportCopy" class="button" type="button" data-i18n="export_copy">复制</button>
            <button id="exportQr" class="button" type="button" data-i18n="export_qr">二维码</button>
          </div>
        </div>
        <div class="export-row export-row-secondary">
          <label class="input-label" data-i18n="export_label_import">导入</label>
          <div class="export-controls">
            <input id="exportInput" class="modern-input export-input" type="text" data-i18n-placeholder="export_input_ph" placeholder="粘贴短文本..." />
            <button id="exportPaste" class="button" type="button" data-i18n="export_paste">粘贴</button>
            <button id="exportApply" class="button" type="button" data-i18n="export_apply">应用</button>
          </div>
        </div>
        <div class="result-head">
          <h2 class="result-title" data-i18n="result_title">判定結果</h2>
          <button id="check" class="button">
            <span data-i18n="check_btn">判定する</span>
          </button>
          <div id="sortWrap" class="sort-wrap" aria-hidden="true">
          <button id="sortBtn" class="button sort-button" type="button" aria-haspopup="menu" aria-expanded="false" data-i18n-aria="sort_label">
              <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 7h12"></path>
                <path d="M6 12h9"></path>
                <path d="M6 17h6"></path>
              </svg>
            </button>
            <div id="sortMenu" class="sort-menu" role="menu">
              <button type="button" data-sort="added" data-i18n="sort_added">按添加顺序</button>
              <button type="button" data-sort="amount_desc" data-i18n="sort_amount_desc">金额从大到小</button>
              <button type="button" data-sort="amount_asc" data-i18n="sort_amount_asc">金额从小到大</button>
              <button type="button" data-sort="group_number" data-i18n="sort_group_number">按组和番号</button>
            </div>
          </div>
          <button id="clearList" class="button" type="button" data-i18n="clear_btn">リストをクリア</button>
        </div>
        <div class="result-box" aria-live="polite">
          <div id="resultTotal" class="result-total" data-i18n="result_desc">ここに結果が表示されます</div>
          <ul id="resultList" class="result-list"></ul>
        </div>
      </div>

    </section>
  </main>

  <div id="scanModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="scanTitle">
      <div class="modal-head">
        <h3 id="scanTitle" data-i18n="scan_title">识别结果</h3>
        <button id="scanClose" class="icon-btn" type="button" aria-label="close" data-i18n-aria="close_label">✕</button>
      </div>
      <div class="modal-body">
        <div class="scan-preview">
          <video id="scanVideo" autoplay playsinline></video>
          <canvas id="scanCanvas"></canvas>
          <button id="scanCloseCam" class="scan-close" type="button" aria-label="close" data-i18n-aria="close_label">✕</button>
          <button id="scanCapture" class="scan-capture" type="button" aria-label="capture" data-i18n-aria="capture_label">
            <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 7h3l2-2h6l2 2h3"></path>
              <rect x="3" y="7" width="18" height="14" rx="2"></rect>
              <circle cx="12" cy="14" r="3"></circle>
            </svg>
          </button>
          <div class="scan-guide">
            <div class="scan-box scan-box-group">
              <span data-i18n="scan_guide_group">123組</span>
            </div>
            <div class="scan-box scan-box-number">
              <span data-i18n="scan_guide_number">123456</span>
            </div>
          </div>
        </div>
        <div class="scan-result">
          <p data-i18n="scan_tip">请对准票面中的组和号</p>
          <div class="scan-fields">
            <div>
              <span data-i18n="group_label">組</span>
              <input id="scanGroup" class="scan-input" inputmode="numeric" pattern="\\d{1,3}" maxlength="3" value="" placeholder="---" />
            </div>
            <div>
              <span data-i18n="number_label">番号</span>
              <input id="scanNumber" class="scan-input" inputmode="numeric" pattern="\\d{6}" maxlength="6" value="" placeholder="------" />
            </div>
          </div>
          <p id="scanStatus" class="scan-status">--</p>
          <div class="scan-debug">
            <div class="scan-debug-head">
              <p class="scan-debug-title" data-i18n="scan_raw_title">OCR RAW</p>
              <button id="scanCopy" class="button" type="button" data-i18n="scan_copy">复制</button>
            </div>
            <pre id="scanRaw" class="scan-raw"></pre>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button id="scanRetry" class="button" type="button" data-i18n="scan_retry">重新识别</button>
        <button id="scanConfirm" class="button" type="button" data-i18n="scan_confirm" disabled>确认添加</button>
      </div>
    </div>
  </div>

  <div id="prizeModal" class="modal prize-modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="prizeTitle">
      <div class="modal-head">
        <h3 id="prizeTitle" data-i18n="prize_title">当选号</h3>
        <button id="prizeClose" class="icon-btn" type="button" aria-label="close" data-i18n-aria="close_label">✕</button>
      </div>
      <div class="modal-body">
        <div class="prize-meta" id="prizeMeta"></div>
        <ul id="prizeList" class="prize-list"></ul>
      </div>
    </div>
  </div>

  <div id="qrModal" class="modal qr-modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="qrTitle">
      <div class="modal-head">
        <h3 id="qrTitle" data-i18n="qr_title">分享二维码</h3>
        <button id="qrClose" class="icon-btn" type="button" aria-label="close" data-i18n-aria="close_label">✕</button>
      </div>
      <div class="modal-body">
        <p class="qr-desc" data-i18n="qr_desc">二维码用于分享当前列表。若已生成短文本或已有号码列表，会附带导入参数；否则为基础链接。</p>
        <div class="qr-box">
          <div id="qrCanvas" class="qr-canvas" aria-label="QR code"></div>
        </div>
        <div class="qr-url">
          <p id="qrUrlText" class="qr-url-text"></p>
          <button id="qrUrlCopy" class="button" type="button" data-i18n="qr_copy">复制链接</button>
        </div>
        <button id="qrSave" class="button" type="button" data-i18n="qr_save">保存图片</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="./main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.5/dist/tesseract.min.js"></script>
</body>
</html>
